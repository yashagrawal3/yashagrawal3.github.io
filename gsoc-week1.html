<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>GSoC Blog - Week 1</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Developer. Data Science. Open Source Enthusiast." />
    <link rel="shortcut icon" href="https://yashagrawal3.github.io/assets/images/ya.png" type="image/png" />
    <link rel="canonical" href="https://yashagrawal3.github.io/gsoc-week1" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Yash Agrawal" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="GSoC Blog - Week 1" />
    <meta property="og:description" content="This is my second GSoC blog which focuses on the workflow involved to porting a activity to gtk+ 3. As the world changes, Sugar cannot stand still. If the platforms we depend upon drop support for the version tools we are using, then we have to either take over maintenance" />
    <meta property="og:url" content="https://yashagrawal3.github.io/gsoc-week1" />
    <meta property="og:image" content="https://yashagrawal3.github.io/assets/images/neighbourhood.svg" />
    <meta property="article:publisher" content="https://www.facebook.com/yashagrawal10" />
    <meta property="article:author" content="https://www.facebook.com/yashagrawal10" />
    <meta property="article:published_time" content="2018-05-14T15:30:00+05:30" />
    <meta property="article:modified_time" content="2018-05-14T15:30:00+05:30" />
    <meta property="article:tag" content="Gsoc" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="GSoC Blog - Week 1" />
    <meta name="twitter:description" content="This is my second GSoC blog which focuses on the workflow involved to porting a activity to gtk+ 3. As the world changes, Sugar cannot stand still. If the platforms we depend upon drop support for the version tools we are using, then we have to either take over maintenance" />
    <meta name="twitter:url" content="https://yashagrawal3.github.io/" />
    <meta name="twitter:image" content="https://yashagrawal3.github.io/assets/images/neighbourhood.svg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Yash Agrawal" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Gsoc" />
    <meta name="twitter:site" content="@YashAgrawal_" />
    <meta name="twitter:creator" content="@YashAgrawal_" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Yash Agrawal",
        "logo": "https://yashagrawal3.github.io/assets/images/yashlogo.png"
    },
    "url": "https://yashagrawal3.github.io/gsoc-week1",
    "image": {
        "@type": "ImageObject",
        "url": "https://yashagrawal3.github.io/assets/images/neighbourhood.svg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://yashagrawal3.github.io/gsoc-week1"
    },
    "description": "This is my second GSoC blog which focuses on the workflow involved to porting a activity to gtk+ 3. As the world changes, Sugar cannot stand still. If the platforms we depend upon drop support for the version tools we are using, then we have to either take over maintenance"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="GSoC Blog - Week 1" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://yashagrawal3.github.io/"><img src="/assets/images/yashlogo.png" alt="Yash Agrawal" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-resume" role="menuitem"><a href="/resume.pdf">Resume</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/yashagrawal10" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/YashAgrawal_" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
            <a class="social-link social-link-tw" href="https://github.com/yashagrawal3" target="_blank" rel="noopener"><i class="fab fa-github fa-2x"></i></a>
            <a class="social-link social-link-tw" href="https://linkedin.com/in/yashagrawall" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-2x"></i></a>
            <a class="social-link social-link-tw" href="mailto:yagrawal900@gmail.com" target="_blank" rel="noopener"><i class="fas fa-envelope fa-2x"></i></a>
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-gsoc ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="14 May 2018">14 May 2018</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/gsoc/'>GSOC</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">GSoC Blog - Week 1</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/neighbourhood.svg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>This is my second GSoC blog which focuses on the workflow involved to porting a activity to gtk+ 3.</p>

<blockquote>
  <p>As the world changes, Sugar cannot stand still. If the platforms we depend upon drop support for the version tools we are using, then we have to either take over maintenance of these tools ourselves as proposed, update our work so that it remains compatible. The migration to GTK-3 is critical.</p>
</blockquote>

<p>As the project description says “GTK+ 2 and GStreamer 0.10 are end of life. We need to upgrade the remaining activities with these dependencies.”, we need to upgrade the Sugar activities to maintain its support and get security update on various platforms. The movement from PyGTK to PyGObject API means no more maintenance of it. GTK+ 3 is a major new version of GTK+ that breaks both API and ABI compared to GTK+ 2, which has remained API- and ABI-stable for a long time. The main purpose of this project is to port dependencies of 25 Sugar activities from “GTK+ 2 and GStreamer 0.10” to “GTK+ 3 and GStreamer 1.0”. The task will be accompanied by updating to the latest version of sugargame and Sugar Toolkit. GTK+ 3 introduced many changes to improve UI by providing a number of new widgets, switches, toolbars etc. A lot of other changes have also been introduced, to name a few: Use of Cairo for Drawing, Use of GtkBox, Removal of HippoCanvas library and many more.</p>

<p>The import of pygtk should be changed to import gi. All the codes which includes gtk should be replaced by Gtk. And there is no gtk.gdk library maintained by the developers so you should replace gtk.gdk with Gdk. All the imports should be changed from <code class="highlighter-rouge">import gtk</code> to from <code class="highlighter-rouge">gi.repository import Gtk</code>. All the imports from sugar should be changed to sugar3. As sugar3 toolkit is based on Gtk3 and sugar toolkit was based on gtk2 so Use sugar3 toolkit.</p>

<p>For example :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>– import pygtk
– pygtk.require(‘2.0‘)
– import gtk
– from sugar.graphics import style
</code></pre></div></div>
<p>should be replaced by :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ import gi
+ gi.require_version(“Gtk“, “3.0“)
+ from gi.repository import Gdk
+ from gi.repository import Gtk
+ from sugar3.graphics import style
</code></pre></div></div>
<p>Hbox, Vbox, pack_start, pack_end : This method pack_start, end takes 4 parameters :</p>

<ul>
  <li>widget to pack</li>
  <li>expand</li>
  <li>fill</li>
  <li>padding</li>
</ul>

<p>Earlier in pygtk it was optional to specify every parameter. If not specified default values were used. But in Gtk3 it is complusory to specify all the 4 parameters. So while porting to Gtk3 if a parameter is not specified in pygtk you can add that parameter and put the default value to it.</p>

<ul>
  <li>If expand was not set, use value True</li>
  <li>If fill was not set, use value True.</li>
  <li>If padding was not set, use value 0.</li>
</ul>

<p>For example :
<code class="highlighter-rouge">– box.pack_start(widget, True, False)</code>
Should be changed to :
<code class="highlighter-rouge">+ box.pack_start(widget, expand=True, fill=False, padding=4)</code></p>

<p>A great guide for porting to gtk+ 3 can be found in sugar-docs.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/yash.jpg" alt="yash" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/yash">Yash Agrawal</a></h4>
                                
                                    <p>a.k.a. yell0wfl4sh, spends most of his time developing and hacking various technology. When he's not doing that, he is normally reordering his spotify playlist or deciding next movie to watch.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/yash">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <script type="text/javascript">
                console.log(https://yashagrawal3.github.io)
                console.log(/gsoc-week1)
            </script>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://yashagrawal3.github.io/gsoc-week1';
                            this.page.identifier = '/gsoc-week1';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://yashagrawal3.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Yash Agrawal &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/gsoc/">Gsoc</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/gsoc-week4">GSoC Blog - Week 4</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/gsoc-week3">GSoC Blog - Week 3</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/gsoc-week2">GSoC Blog - Week 2</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/gsoc/">
                                
                                    See all 4 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/gsoc-week2">
                <div class="post-card-image" style="background-image: url(/assets/images/iknowabcs.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/gsoc-week2">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Gsoc</span>
                            
                        
                    

                    <h2 class="post-card-title">GSoC Blog - Week 2</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>This is my third GSoC blog which tells work done this week. ## Work Done This Week: This week I worked on following activities: - I Can Read Activity - Record Activity -</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yash.jpg" alt="Yash Agrawal" />
                        
                        <span class="post-card-author">
                            <a href="/author/yash/">Yash Agrawal</a>
                        </span>
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/gsoc-welcome">
                <div class="post-card-image" style="background-image: url(/assets/images/gsoc-mail.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/gsoc-welcome">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Gsoc</span>
                            
                        
                    

                    <h2 class="post-card-title">GSoC’ 18 with Sugar Labs</h2>
                </header>
                <section class="post-card-excerpt">
                    <p>Wohoo! I have been selected in Google Summer of Code 2018. I am very excited to work with Sugar Labs this summer on ‘Say no to GTK+ 2’ project. Thanks to GSoC, Google</p>
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yash.jpg" alt="Yash Agrawal" />
                        
                        <span class="post-card-author">
                            <a href="/author/yash/">Yash Agrawal</a>
                        </span>
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://yashagrawal3.github.io/">
            
                <img src="/assets/images/ya.png" alt="Yash Agrawal icon" />
            
            <span>Yash Agrawal</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">GSoC Blog - Week 1</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=GSoC+Blog+-+Week+1&amp;url=https://jekyller.github.io/jasper2/gsoc-week1"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://jekyller.github.io/jasper2/gsoc-week1"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://yashagrawal3.github.io/">Yash Agrawal</a> &copy; 2018</section>
                
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://facebook.com/yashagrawal10" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com/YashAgrawal_" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://github.com/yashagrawal3/" target="_blank" rel="noopener">Github</a>
                    <a href="https://www.linkedin.com/in/yashagrawall/" target="_blank" rel="noopener">LinkedIn</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>

    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
     <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106206549-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-106206549-1');
</script>

    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
